<!DOCTYPE html>
<html class="h-full" lang="fr">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Récoltons les informations</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#3b82f6",
                        "background-light": "#f0f8ff",
                        "background-dark": "#1e293b",
                        "surface-light": "#ffffff",
                        "surface-dark": "#334155",
                        "text-light": "#1f2937",
                        "text-dark": "#e2e8f0",
                        "text-secondary-light": "#6b7280",
                        "text-secondary-dark": "#94a3b8",
                        "accent-light": "#fb923c",
                        "accent-dark": "#f97316",
                        "button-primary": "#4f46e5",
                        "button-hover": "#4338ca",
                    },
                    fontFamily: {
                        display: ["Poppins", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "1rem",
                    },
                },
            },
        };
    </script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }

        .chat-bubble {
            border-bottom-left-radius: 0;
        }

        .chat-bubble-container {
            border-width: 2px;
            border-color: #d1d5db;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-out {
            animation: fadeOut 0.3s ease-out;
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        /* Limiter la hauteur du menu déroulant */
        select {
            max-height: 300px;
        }

        select[size] {
            max-height: 300px;
            overflow-y: auto;
        }

        /* Help Button Styles */
        .help-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            margin-left: 8px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
            border: none;
            vertical-align: middle;
        }

        .help-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        }

        /* Help Panel Styles */
        .help-panel {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, margin-top 0.4s ease, opacity 0.3s ease;
            opacity: 0;
            margin-top: 0;
        }

        .help-panel.expanded {
            max-height: 500px;
            margin-top: 12px;
            opacity: 1;
        }

        .help-content {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 4px solid #3b82f6;
            padding: 12px 16px;
            border-radius: 8px;
            display: flex;
            gap: 12px;
            align-items: start;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
        }

        .dark .help-content {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            border-left-color: #60a5fa;
        }

        .help-avatar {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px;
        }

        .help-avatar img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .help-text {
            flex: 1;
            font-size: 13px;
            line-height: 1.5;
            color: #1e40af;
        }

        .dark .help-text {
            color: #bfdbfe;
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>

<body
    class="bg-gradient-to-b from-orange-50 to-blue-300 dark:from-slate-800 dark:to-slate-900 font-display text-text-light dark:text-text-dark min-h-screen">
    <header
        class="flex justify-between items-center py-4 px-4 sm:px-6 sticky top-0 z-50 bg-white/30 dark:bg-slate-900/30 backdrop-blur-sm">
        <div class="flex items-center gap-4">
            <a href="Home_desktop.html"
                class="flex items-center gap-2 px-4 py-2 text-sm font-semibold text-primary border-2 border-primary rounded-full hover:bg-primary/10 transition-colors bg-white/50 dark:bg-gray-800/50">
                <span class="material-icons text-primary" style="font-size: 20px;">home</span>
                <span>Accueil</span>
            </a>
            <a href="Estimation_desktop.html"
                class="px-4 py-2 text-sm font-semibold text-primary border-2 border-primary rounded-full hover:bg-primary/10 transition-colors bg-white/50 dark:bg-gray-800/50">
                Estimez
            </a>
        </div>
        <div class="flex items-center gap-4">
            <a href="Bons_gestes.html"
                class="px-4 py-2 text-sm font-semibold text-primary border-2 border-primary rounded-full hover:bg-primary/10 transition-colors bg-white/50 dark:bg-gray-800/50">
                Les bons gestes !
            </a>
            <a href="About-us_desktop.html"
                class="px-4 py-2 text-sm font-semibold text-primary border-2 border-primary rounded-full hover:bg-primary/10 transition-colors bg-white/50 dark:bg-gray-800/50">
                Qui sommes-nous ?
            </a>
        </div>
    </header>
    <div
        class="p-4 sm:p-6 flex-grow flex flex-col bg-gradient-to-b from-orange-50 to-blue-300 dark:from-slate-800 dark:to-slate-900">
        <main class="py-8 flex flex-col items-center justify-center max-w-2xl mx-auto w-full">
            <h1 class="text-xl sm:text-2xl font-bold text-primary text-center mb-8">
                Récoltons les informations nécessaires à l'estimation pour améliorer votre DPE !
            </h1>

            <!-- Indicateur de progression -->
            <div class="w-full max-w-md mb-4">
                <div class="flex items-center justify-between text-sm text-primary font-semibold mb-2">
                    <span id="progressText">Question 1/10</span>
                    <span id="progressPercent">10%</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                    <div id="progressBar" class="bg-primary h-2 rounded-full transition-all duration-500"
                        style="width: 10%"></div>
                </div>
            </div>

            <div
                class="w-full mx-auto relative chat-bubble-container rounded-2xl bg-surface-light dark:bg-surface-dark shadow-lg p-6">
                <div
                    class="absolute -top-8 left-1/2 -translate-x-1/2 w-16 h-16 bg-surface-light dark:bg-surface-dark rounded-full flex items-center justify-center border-2 border-gray-300 dark:border-gray-600">
                    <img alt="Watty the robot mascot" class="w-12 h-12" src="Images/Image_6.png" />
                </div>
                <div class="mt-8">
                    <div id="chatContent"
                        class="relative bg-gray-100 dark:bg-slate-600 p-4 rounded-xl chat-bubble mx-auto max-w-2xl">
                        <!-- Le contenu du chat sera inséré ici par JavaScript -->
                    </div>
                </div>
                <div class="flex justify-end mt-6">
                    <button id="nextButton"
                        class="px-6 py-2 text-sm font-semibold text-white bg-primary border-2 border-primary rounded-full hover:bg-button-hover transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled>
                        Suivant
                    </button>
                </div>
            </div>
        </main>
        <footer class="mt-12 text-center text-gray-500 dark:text-gray-400 text-sm overflow-hidden">
            <p class="mb-4">Créé par l'équipe Des P'tites Economies</p>
            <div class="logo-slider">
                <div class="logo-track">
                    <!-- Original Logos -->
                    <img alt="Logo HEC Paris" class="h-16 mx-8 object-contain" src="Images/Image_2.png" />
                    <img alt="Logo Open Data University" class="h-16 mx-8 object-contain" src="Images/Image_4.png" />
                    <img alt="Logo Des P'tites Economies" class="h-20 mx-8 object-contain" src="Images/Image_5.png" />
                    <img alt="Logo Enedis" class="h-16 mx-8 object-contain" src="Images/Image_1.png" />
                    <!-- Duplicated Logos -->
                    <img alt="Logo HEC Paris" class="h-16 mx-8 object-contain" src="Images/Image_2.png" />
                    <img alt="Logo Open Data University" class="h-16 mx-8 object-contain" src="Images/Image_4.png" />
                    <img alt="Logo Des P'tites Economies" class="h-20 mx-8 object-contain" src="Images/Image_5.png" />
                    <img alt="Logo Enedis" class="h-16 mx-8 object-contain" src="Images/Image_1.png" />
                    <!-- Triplicated Logos for wide screens -->
                    <img alt="Logo HEC Paris" class="h-16 mx-8 object-contain" src="Images/Image_2.png" />
                    <img alt="Logo Open Data University" class="h-16 mx-8 object-contain" src="Images/Image_4.png" />
                    <img alt="Logo Des P'tites Economies" class="h-20 mx-8 object-contain" src="Images/Image_5.png" />
                    <img alt="Logo Enedis" class="h-16 mx-8 object-contain" src="Images/Image_1.png" />
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Définition des questions
        const questions = [
            {
                id: 'departement',
                label: 'Département',
                text: "Salut, moi je m'appelle <span class='font-bold text-gray-900 dark:text-gray-100'>Watty</span> ! Ce sera moi qui t'accompagne pour récolter toutes les informations nécessaires pour que tu puisses faire <span class='font-bold text-primary'>Des P'tites Économies</span>.<br><br>Commençons par voir où est-ce que tu habites. Tu habites dans le",
                options: ['01 - Ain', '02 - Aisne', '03 - Allier', '04 - Alpes-de-Haute-Provence', '05 - Hautes-Alpes', '06 - Alpes-Maritimes', '07 - Ardèche', '08 - Ardennes', '09 - Ariège', '10 - Aube', '11 - Aude', '12 - Aveyron', '13 - Bouches-du-Rhône', '14 - Calvados', '15 - Cantal', '16 - Charente', '17 - Charente-Maritime', '18 - Cher', '19 - Corrèze', '21 - Côte-d\'Or', '22 - Côtes-d\'Armor', '23 - Creuse', '24 - Dordogne', '25 - Doubs', '26 - Drôme', '27 - Eure', '28 - Eure-et-Loir', '29 - Finistère', '2A - Corse-du-Sud', '2B - Haute-Corse', '30 - Gard', '31 - Haute-Garonne', '32 - Gers', '33 - Gironde', '34 - Hérault', '35 - Ille-et-Vilaine', '36 - Indre', '37 - Indre-et-Loire', '38 - Isère', '39 - Jura', '40 - Landes', '41 - Loir-et-Cher', '42 - Loire', '43 - Haute-Loire', '44 - Loire-Atlantique', '45 - Loiret', '46 - Lot', '47 - Lot-et-Garonne', '48 - Lozère', '49 - Maine-et-Loire', '50 - Manche', '51 - Marne', '52 - Haute-Marne', '53 - Mayenne', '54 - Meurthe-et-Moselle', '55 - Meuse', '56 - Morbihan', '57 - Moselle', '58 - Nièvre', '59 - Nord', '60 - Oise', '61 - Orne', '62 - Pas-de-Calais', '63 - Puy-de-Dôme', '64 - Pyrénées-Atlantiques', '65 - Hautes-Pyrénées', '66 - Pyrénées-Orientales', '67 - Bas-Rhin', '68 - Haut-Rhin', '69 - Rhône', '70 - Haute-Saône', '71 - Saône-et-Loire', '72 - Sarthe', '73 - Savoie', '74 - Haute-Savoie', '75 - Paris', '76 - Seine-Maritime', '77 - Seine-et-Marne', '78 - Yvelines', '79 - Deux-Sèvres', '80 - Somme', '81 - Tarn', '82 - Tarn-et-Garonne', '83 - Var', '84 - Vaucluse', '85 - Vendée', '86 - Vienne', '87 - Haute-Vienne', '88 - Vosges', '89 - Yonne', '90 - Territoire de Belfort', '91 - Essonne', '92 - Hauts-de-Seine', '93 - Seine-Saint-Denis', '94 - Val-de-Marne', '95 - Val-d\'Oise', '971 - Guadeloupe', '972 - Martinique', '973 - Guyane', '974 - La Réunion', '976 - Mayotte', 'Je ne sais pas']
            },
            {
                id: 'occupants',
                label: 'Nombre d\'occupants',
                text: "Parfait ! Maintenant dis-moi, combien êtes-vous dans le logement ? Vous êtes",
                options: ['1', '2', '3', '4', '5+', 'Je ne sais pas']
            },
            {
                id: 'type_logement',
                label: 'Type de logement',
                text: "Très bien ! Et tu habites dans quel type de logement ?",
                options: ['Appartement', 'Maison individuelle', 'Studio', 'Je ne sais pas']
            },
            {
                id: 'surface',
                label: 'Surface habitable',
                text: "D'accord ! Et quelle est la surface de ton logement ?",
                options: ['Moins de 30m²', '30-50m²', '50-80m²', '80-120m²', 'Plus de 120m²', 'Je ne sais pas']
            },
            {
                id: 'annee_construction',
                label: 'Année de construction',
                text: "Maintenant, sais-tu en quelle année ton logement a été construit ?",
                options: ['Avant 1975', '1975-1990', '1990-2005', '2005-2012', 'Après 2012', 'Je ne sais pas'],
                help: "Tu peux trouver l'année de construction sur ton acte de propriété, ton bail, ou en consultant le cadastre en ligne. Si tu habites dans un immeuble, vérifie la plaque à l'entrée ou demande au syndic !"
            },
            {
                id: 'chauffage',
                label: 'Type de chauffage',
                text: "Super ! Parlons de ton système de chauffage. Quel type de chauffage as-tu ?",
                options: ['Électrique', 'Gaz', 'Fioul', 'Pompe à chaleur', 'Bois', 'Je ne sais pas'],
                help: "Regarde ta facture d'énergie ou ton compteur : électrique (compteur Linky), gaz (compteur de gaz), fioul (cuve visible). Une pompe à chaleur a une unité extérieure bruyante. Le chauffage au bois, c'est une chaudière ou un poêle visible !"
            },
            {
                id: 'eau_chaude',
                label: 'Type d\'eau chaude',
                text: "Et pour l'eau chaude sanitaire, comment est-elle produite ?",
                options: ['Électrique', 'Gaz', 'Ballon thermodynamique', 'Solaire', 'Je ne sais pas'],
                help: "C'est souvent le même système que le chauffage ! Regarde ton ballon d'eau chaude : s'il est petit et froid en haut, c'est un ballon thermodynamique. S'il a des panneaux sur le toit, c'est solaire. Sinon, c'est électrique ou gaz."
            },
            {
                id: 'isolation',
                label: 'Isolation des murs',
                text: "Parlons maintenant de l'isolation. Tes murs sont-ils isolés ?",
                options: ['Non isolé', 'Partiellement isolé', 'Totalement isolé', 'Je ne sais pas'],
                help: "Touche tes murs en hiver : s'ils sont très froids, ils ne sont pas isolés. Regarde aussi de l'extérieur : si tu vois une épaisseur supplémentaire ou un crépi récent, c'est probablement isolé. En cas de doute, choisis 'Je ne sais pas' !"
            },
            {
                id: 'fenetres',
                label: 'Type de fenêtres',
                text: "Et tes fenêtres, quel type de vitrage ont-elles ?",
                options: ['Simple vitrage', 'Double vitrage ancien', 'Double vitrage récent', 'Triple vitrage', 'Je ne sais pas'],
                help: "Approche une flamme (briquet) de la vitre : si tu vois 2 reflets, c'est du double vitrage. Si tu en vois 3, c'est du triple vitrage. Un seul reflet = simple vitrage. Le double vitrage récent a souvent une petite étiquette avec l'année."
            },
            {
                id: 'ventilation',
                label: 'Système de ventilation',
                text: "Dernière question ! Quel système de ventilation as-tu dans ton logement ?",
                options: ['Naturelle', 'VMC simple flux', 'VMC double flux', 'Aucune', 'Je ne sais pas'],
                help: "Regarde dans ta salle de bain ou WC : tu vois une grille d'aération au plafond ? Si elle est motorisée (bruit quand elle tourne), c'est une VMC. La VMC double flux a aussi des bouches d'air dans les pièces de vie. Sinon, c'est ventilation naturelle."
            }
        ];

        let currentQuestion = 0;
        let responses = {};

        // Fonction pour afficher une question
        function displayQuestion(index) {
            const question = questions[index];
            const chatContent = document.getElementById('chatContent');

            // Créer le contenu HTML
            let html = `<p class="text-sm mb-4">${question.text}`;

            // Ajouter le champ de saisie (input avec autocomplétion pour département, select classique pour les autres)
            if (index === 0) {
                // Pour le département, utiliser un input avec datalist pour l'autocomplétion
                html += `
                <span class="relative inline-flex items-center ml-2">
                    <input 
                        type="text" 
                        id="questionSelect" 
                        list="departementList"
                        placeholder="Chercher..."
                        class="bg-blue-100 dark:bg-slate-700 border-2 border-primary text-primary font-semibold text-sm rounded-lg py-1 pl-3 pr-3 focus:outline-none focus:ring-2 focus:ring-primary w-48 align-middle"
                        value="${responses[question.id] || ''}"
                    />
                    <datalist id="departementList">
            `;
                question.options.forEach(option => {
                    html += `<option value="${option}">${option}</option>`;
                });
                html += `
                    </datalist>
                </span>
            `;
            } else {
                // Pour les autres questions, menu déroulant classique
                html += `
                <span class="relative inline-flex items-center ml-2">
                    <select id="questionSelect" 
                        class="appearance-none bg-blue-100 dark:bg-slate-700 border-2 border-primary text-primary font-semibold text-sm rounded-lg py-1 pl-3 pr-8 focus:outline-none focus:ring-2 focus:ring-primary cursor-pointer align-middle">
                        <option value="">--</option>
            `;
                question.options.forEach(option => {
                    const selected = responses[question.id] === option ? 'selected' : '';
                    html += `<option value="${option}" ${selected}>${option}</option>`;
                });
                html += `
                    </select>
                    <span class="material-icons absolute right-2 top-1/2 -translate-y-1/2 text-primary pointer-events-none">expand_more</span>
                </span>
            `;
            }

            if (index === 9) {
                html += ` c'est ça ? Parfait, on a tout ce qu'il faut pour ton estimation !`;
            } else {
                html += ` c'est ça ?`;
            }

            // Ajouter le bouton d'aide si la question a une propriété help
            if (question.help) {
                html += `
                    <button class="help-button" onclick="toggleHelp()" aria-label="Aide">?</button>
                `;
            }

            html += `</p>`;

            // Ajouter le panneau d'aide extensible si la question a une propriété help
            if (question.help) {
                html += `
                    <div id="helpPanel" class="help-panel">
                        <div class="help-content">
                            <div class="help-avatar">
                                <img src="Images/Image_6.png" alt="Watty">
                            </div>
                            <div class="help-text">
                                ${question.help}
                            </div>
                        </div>
                    </div>
                `;
            }

            html += `<div class="absolute -bottom-2 left-0 w-4 h-4 bg-gray-100 dark:bg-slate-600" style="clip-path: polygon(0 0, 100% 100%, 100% 0);"></div>`;

            // Ajouter avec animation
            chatContent.classList.add('fade-out');
            setTimeout(() => {
                chatContent.innerHTML = html;
                chatContent.classList.remove('fade-out');
                chatContent.classList.add('fade-in');

                // Ajouter l'événement de changement au select ou input
                const inputElement = document.getElementById('questionSelect');
                inputElement.addEventListener('change', handleSelectChange);
                inputElement.addEventListener('input', handleSelectChange); // Pour l'input text

                // Vérifier si une réponse existe déjà
                if (responses[question.id]) {
                    document.getElementById('nextButton').disabled = false;
                }
            }, 300);

            // Mettre à jour la progression
            updateProgress();
        }

        // Fonction pour afficher/masquer le panneau d'aide
        function toggleHelp() {
            const helpPanel = document.getElementById('helpPanel');
            if (helpPanel) {
                helpPanel.classList.toggle('expanded');
            }
        }

        // Gérer le changement de sélection
        function handleSelectChange(e) {
            const question = questions[currentQuestion];
            const value = e.target.value;

            if (value) {
                responses[question.id] = value;
                document.getElementById('nextButton').disabled = false;
            } else {
                delete responses[question.id];
                document.getElementById('nextButton').disabled = true;
            }
        }

        // Mettre à jour la barre de progression
        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `Question ${currentQuestion + 1}/${questions.length}`;
            document.getElementById('progressPercent').textContent = `${Math.round(progress)}%`;
        }

        // Passer à la question suivante
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                document.getElementById('nextButton').disabled = true;
                displayQuestion(currentQuestion);
            } else {
                // Sauvegarder les réponses et rediriger
                saveAndRedirect();
            }
        }

        // Sauvegarder les données et rediriger
        function saveAndRedirect() {
            // Créer un objet avec labels et valeurs
            const dataToSave = questions.map(q => ({
                label: q.label,
                value: responses[q.id] || 'Non renseigné'
            }));

            localStorage.setItem('dpe_responses', JSON.stringify(dataToSave));
            window.location.href = 'Estimation_2.html';
        }

        // Événement du bouton Suivant
        document.getElementById('nextButton').addEventListener('click', nextQuestion);

        // Initialiser la première question
        displayQuestion(0);
    </script>

</body>

</html>